


<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <script type="text/javascript">

      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-67846571-2']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Production Install on Ubuntu 14.04 LTS &mdash; Mattermost 3.5 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../_static/theme.css" type="text/css" />
  

  
    <link rel="top" title="Mattermost 3.5 documentation" href="../index.html"/>
        <link rel="up" title="Mattermost Administrator’s Guide" href="../guides/administrator.html"/>
        <link rel="next" title="Production Install on Ubuntu 16.04 LTS" href="prod-ubuntu-16.04.html"/>
        <link rel="prev" title="Production Docker Deployment" href="prod-docker.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> Mattermost
          

          
          </a>

          
            
            
              <div class="version">
                3.5
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../overview/index.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../guides/user.html">User&#8217;s Guide</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../guides/administrator.html">Administrator&#8217;s Guide</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../guides/administrator.html#installing-mattermost">Installing Mattermost</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="requirements.html">Software &amp; Hardware Requirements</a></li>
<li class="toctree-l3"><a class="reference internal" href="install-ubuntu-1404-overview.html">Installing on Ubuntu 14.04 LTS</a></li>
<li class="toctree-l3"><a class="reference internal" href="docker-local-machine.html">Local Machine Setup using Docker</a></li>
<li class="toctree-l3"><a class="reference internal" href="docker-ebs.html">AWS Elastic Beanstalk Docker Setup</a></li>
<li class="toctree-l3"><a class="reference internal" href="ee-install.html">Enterprise Install and Upgrade</a></li>
<li class="toctree-l3"><a class="reference internal" href="prod-rhel-6.html">Production Install on RHEL 6.6</a></li>
<li class="toctree-l3"><a class="reference internal" href="prod-rhel-7.html">Production Install on RHEL 7.1+</a></li>
<li class="toctree-l3"><a class="reference internal" href="prod-debian.html">Production Install on Debian Jessie</a></li>
<li class="toctree-l3"><a class="reference internal" href="prod-docker.html">Production Docker Deployment</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Production Install on Ubuntu 14.04 LTS</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#install-ubuntu-server-x64-14-04-lts">Install Ubuntu Server (x64) 14.04 LTS</a></li>
<li class="toctree-l4"><a class="reference internal" href="#set-up-database-server">Set up Database Server</a></li>
<li class="toctree-l4"><a class="reference internal" href="#set-up-mattermost-server">Set up Mattermost Server</a></li>
<li class="toctree-l4"><a class="reference internal" href="#set-up-nginx-server">Set up NGINX Server</a></li>
<li class="toctree-l4"><a class="reference internal" href="#set-up-nginx-with-ssl-recommended">Set up NGINX with SSL (Recommended)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#setup-http2">Setup HTTP2</a></li>
<li class="toctree-l4"><a class="reference internal" href="#test-setup-and-configure-mattermost-server">Test setup and configure Mattermost Server</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="prod-ubuntu-16.04.html">Production Install on Ubuntu 16.04 LTS</a></li>
<li class="toctree-l3"><a class="reference internal" href="smtp-email-setup.html">SMTP Email Setup</a></li>
<li class="toctree-l3"><a class="reference internal" href="troubleshooting.html">Troubleshooting</a></li>
<li class="toctree-l3"><a class="reference internal" href="i18n.html">Chinese, Korean &amp; Japanese Search</a></li>
<li class="toctree-l3"><a class="reference internal" href="desktop.html">Desktop Application Install Guides</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../guides/administrator.html#configuring-mattermost">Configuring Mattermost</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guides/administrator.html#deployment">Deployment</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guides/administrator.html#administration">Administration</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../guides/integration.html">Integration Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../guides/developer.html">Developer&#8217;s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../guides/core.html">Core Team Handbook</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">Mattermost</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../guides/administrator.html">Mattermost Administrator&#8217;s Guide</a> &raquo;</li>
      
    <li>Production Install on Ubuntu 14.04 LTS</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="https://github.com/mattermost/docs/blob/master/source/install/prod-ubuntu-1404.rst" class="fa fa-github"> Edit on GitHub</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="production-install-on-ubuntu-14-04-lts">
<span id="prod-ubuntu-1404"></span><h1>Production Install on Ubuntu 14.04 LTS<a class="headerlink" href="#production-install-on-ubuntu-14-04-lts" title="Permalink to this headline">¶</a></h1>
<p>Install Mattermost in production mode on one, two or three machines, using the following steps:</p>
<ul class="simple">
<li><a class="reference internal" href="#install-ubuntu-server-x64-14-04-lts">Install Ubuntu Server (x64) 14.04 LTS</a></li>
<li><a class="reference internal" href="#set-up-database-server">Set up Database Server</a></li>
<li><a class="reference internal" href="#set-up-mattermost-server">Set up Mattermost Server</a></li>
<li><a class="reference internal" href="#set-up-nginx-server">Set up NGINX Server</a></li>
</ul>
<div class="section" id="install-ubuntu-server-x64-14-04-lts">
<h2>Install Ubuntu Server (x64) 14.04 LTS<a class="headerlink" href="#install-ubuntu-server-x64-14-04-lts" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li>Set up 3 machines with Ubuntu 14.04 with 2GB of RAM or more. The
servers will be used for the Proxy, Mattermost (must be
x64), and Database.<ul>
<li><strong>Optional:</strong> You can also use a <strong>1 machine setup</strong> (Proxy, Mattermost and Database on one machine) or a <strong>2 machine setup</strong> (Proxy and Mattermost on one machine, Database on another) depending on your data center standards.</li>
</ul>
</li>
<li>Make sure the system is up to date with the most recent security
patches.<ul>
<li><code class="docutils literal"><span class="pre">sudo</span> <span class="pre">apt-get</span> <span class="pre">update</span></code></li>
<li><code class="docutils literal"><span class="pre">sudo</span> <span class="pre">apt-get</span> <span class="pre">upgrade</span></code></li>
</ul>
</li>
</ol>
</div>
<div class="section" id="set-up-database-server">
<h2>Set up Database Server<a class="headerlink" href="#set-up-database-server" title="Permalink to this headline">¶</a></h2>
<p>Install and set up either PostgreSQL 9.3 or MySQL 5.6.</p>
<div class="section" id="set-up-postresql">
<h3>Set up PostreSQL<a class="headerlink" href="#set-up-postresql" title="Permalink to this headline">¶</a></h3>
<ol class="arabic">
<li><p class="first">For the purposes of this guide we will assume this server has an IP
address of 10.10.10.1</p>
</li>
<li><p class="first">Install PostgreSQL 9.3+</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">sudo</span> <span class="pre">apt-get</span> <span class="pre">install</span> <span class="pre">postgresql</span> <span class="pre">postgresql-contrib</span></code></li>
</ul>
</li>
<li><p class="first">PostgreSQL created a user account called <code class="docutils literal"><span class="pre">postgres</span></code>. You will need
to log into that account with:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">sudo</span> <span class="pre">-i</span> <span class="pre">-u</span> <span class="pre">postgres</span></code></li>
</ul>
</li>
<li><p class="first">You can get a PostgreSQL prompt by typing:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">psql</span></code></li>
</ul>
</li>
<li><p class="first">Create the Mattermost database by typing:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">postgres=#</span> <span class="pre">CREATE</span> <span class="pre">DATABASE</span> <span class="pre">mattermost;</span></code></li>
</ul>
</li>
<li><p class="first">Create the Mattermost user by typing:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">postgres=#</span> <span class="pre">CREATE</span> <span class="pre">USER</span> <span class="pre">mmuser</span> <span class="pre">WITH</span> <span class="pre">PASSWORD</span> <span class="pre">'mmuser_password';</span></code></li>
</ul>
</li>
<li><p class="first">Grant the user access to the Mattermost database by typing:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">postgres=#</span> <span class="pre">GRANT</span> <span class="pre">ALL</span> <span class="pre">PRIVILEGES</span> <span class="pre">ON</span> <span class="pre">DATABASE</span> <span class="pre">mattermost</span> <span class="pre">to</span> <span class="pre">mmuser;</span></code></li>
</ul>
</li>
<li><p class="first">You can exit out of PostgreSQL by typing:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">postgre=#</span> <span class="pre">\q</span></code></li>
</ul>
</li>
<li><p class="first">You can exit the postgres account by typing:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">exit</span></code></li>
</ul>
</li>
<li><p class="first">Allow Postgres to listen on all assigned IP Addresses</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">sudo</span> <span class="pre">vi</span> <span class="pre">/etc/postgresql/9.3/main/postgresql.conf</span></code></li>
<li>Uncomment <code class="docutils literal"><span class="pre">listen_addresses</span></code> and change <code class="docutils literal"><span class="pre">localhost</span></code> to <code class="docutils literal"><span class="pre">*</span></code></li>
</ul>
</li>
<li><p class="first">Alter pg_hba.conf to allow the mattermost server to talk to the
postgres database</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">sudo</span> <span class="pre">vi</span> <span class="pre">/etc/postgresql/9.3/main/pg_hba.conf</span></code></li>
<li>Add the following line to the <code class="docutils literal"><span class="pre">IPv4</span> <span class="pre">local</span> <span class="pre">connections</span></code></li>
<li><code class="docutils literal"><span class="pre">host</span> <span class="pre">all</span> <span class="pre">all</span> <span class="pre">10.10.10.2/32</span> <span class="pre">md5</span></code></li>
</ul>
</li>
<li><p class="first">Reload Postgres database</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">sudo</span> <span class="pre">/etc/init.d/postgresql</span> <span class="pre">reload</span></code></li>
</ul>
<p>check with netstat command to see postgresql actually running on given ip and port</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">sudo</span> <span class="pre">netstat</span> <span class="pre">-anp</span> <span class="pre">|</span> <span class="pre">grep</span> <span class="pre">5432</span></code></li>
</ul>
<p>try restarting the postgresql service if reload won&#8217;t work</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">sudo</span> <span class="pre">service</span> <span class="pre">postgresql</span> <span class="pre">restart</span></code></li>
</ul>
</li>
<li><p class="first">Attempt to connect with the new created user to verify everything
looks good</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">psql</span> <span class="pre">--host=10.10.10.1</span> <span class="pre">--dbname=mattermost</span> <span class="pre">--username=mmuser</span> <span class="pre">--password</span></code></li>
<li><code class="docutils literal"><span class="pre">mattermost=&gt;</span> <span class="pre">\q</span></code></li>
</ul>
</li>
</ol>
</div>
<div class="section" id="set-up-mysql-database-server">
<h3>Set up MySQL Database Server<a class="headerlink" href="#set-up-mysql-database-server" title="Permalink to this headline">¶</a></h3>
<ol class="arabic">
<li><p class="first">Install MySQL 5.6.</p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal"><span class="pre">sudo</span> <span class="pre">apt-get</span> <span class="pre">install</span> <span class="pre">mysql-server-5.6</span></code></li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Log in to MySQL as root.</p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal"><span class="pre">mysql</span> <span class="pre">-u</span> <span class="pre">root</span> <span class="pre">-p</span></code></li>
</ul>
<p>When prompted, enter the root password that you created when installing MySQL.</p>
</div></blockquote>
</li>
<li><p class="first">Create the Mattermost user, &#8216;mmuser&#8217;.</p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal"><span class="pre">mysql&gt;</span> <span class="pre">create</span> <span class="pre">user</span> <span class="pre">'mmuser'&#64;'%'</span> <span class="pre">identified</span> <span class="pre">by</span> <span class="pre">'mmuser-password';</span></code></li>
</ul>
<p><strong>Notes</strong>:</p>
<ol class="arabic simple">
<li>Use a password that is more secure than &#8216;mmuser-password&#8217;</li>
<li>The &#8216;%&#8217; means that mmuser can connect from any machine on the network.   However, it&#8217;s more secure to use the IP address of the machine that hosts Mattermost. For example, if you install Mattermost on the machine with IP address 10.10.10.2, then use the following command:</li>
</ol>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">mysql&gt;</span> <span class="pre">create</span> <span class="pre">user</span> <span class="pre">'mmuser'&#64;'10.10.10.2'</span> <span class="pre">identified</span> <span class="pre">by</span> <span class="pre">'mmuser-password';</span></code></li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Create the Mattermost database.</p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal"><span class="pre">mysql&gt;</span> <span class="pre">create</span> <span class="pre">database</span> <span class="pre">mattermost;</span></code></li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Grant access privileges to the user &#8216;mmuser&#8217;</p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal"><span class="pre">mysql&gt;</span> <span class="pre">grant</span> <span class="pre">all</span> <span class="pre">privileges</span> <span class="pre">on</span> <span class="pre">mattermost.*</span> <span class="pre">to</span> <span class="pre">'mmuser'&#64;'%';</span></code></li>
</ul>
</div></blockquote>
</li>
</ol>
</div>
</div>
<div class="section" id="set-up-mattermost-server">
<h2>Set up Mattermost Server<a class="headerlink" href="#set-up-mattermost-server" title="Permalink to this headline">¶</a></h2>
<p>For the purposes of this guide we will assume this server has an IP address of <code class="docutils literal"><span class="pre">10.10.10.2</span></code></p>
<ol class="arabic">
<li><p class="first">Create a mattermost user and group</p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal"><span class="pre">sudo</span> <span class="pre">adduser</span> <span class="pre">--system</span> <span class="pre">--group</span> <span class="pre">mattermost</span></code></li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Change to the mattermost home directory.</p>
<blockquote>
<div><p><code class="docutils literal"><span class="pre">cd</span> <span class="pre">/home/mattermost</span></code></p>
</div></blockquote>
</li>
<li><p class="first">Download <a class="reference external" href="https://docs.mattermost.com/administration/upgrade.html#version-archive">the latest version of the Mattermost Server</a> by typing:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">wget</span> <span class="pre">https://releases.mattermost.com/X.X.X/mattermost-X.X.X-linux-amd64.tar.gz</span></code></li>
<li>Where <code class="docutils literal"><span class="pre">vX.X.X</span></code> is the latest version.</li>
</ul>
</li>
<li><p class="first">Extract the Mattermost Server files by typing:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">sudo</span> <span class="pre">tar</span> <span class="pre">-xvzf</span> <span class="pre">*.gz</span></code></li>
</ul>
</li>
<li><p class="first">Change the user and group of the extracted files to mattermost</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">sudo</span> <span class="pre">chown</span> <span class="pre">-R</span> <span class="pre">mattermost:mattermost</span> <span class="pre">mattermost/</span></code></li>
</ul>
</li>
<li><p class="first">Create the storage directory for files. We assume you will have
attached a large drive for storage of images and files. For this
setup we will assume the directory is located at
<code class="docutils literal"><span class="pre">/mattermost/data</span></code>.</p>
<ul class="simple">
<li>Create the directory by typing:</li>
<li><code class="docutils literal"><span class="pre">sudo</span> <span class="pre">mkdir</span> <span class="pre">-p</span> <span class="pre">/mattermost/data</span></code></li>
<li>Set the mattermost account as the directory owner by typing:</li>
<li><code class="docutils literal"><span class="pre">sudo</span> <span class="pre">chown</span> <span class="pre">-R</span> <span class="pre">mattermost:mattermost</span> <span class="pre">/mattermost</span></code></li>
</ul>
</li>
<li><p class="first">Configure Mattermost Server by editing the config.json file at
<code class="docutils literal"><span class="pre">/home/mattermost/config</span></code></p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">cd</span> <span class="pre">/home/mattermost/mattermost/config</span></code></li>
<li>Edit the file by typing:</li>
<li><code class="docutils literal"><span class="pre">vi</span> <span class="pre">config.json</span></code></li>
<li>If you are using PostgreSQL:</li>
</ul>
<blockquote>
<div><ul class="simple">
<li>Set <code class="docutils literal"><span class="pre">DriverName&quot;:</span></code> to <code class="docutils literal"><span class="pre">&quot;postgres&quot;</span></code></li>
<li>Set <code class="docutils literal"><span class="pre">&quot;DataSource:&quot;</span></code> to the following value: <code class="docutils literal"><span class="pre">&quot;postgres://mmuser:mmuser_password&#64;10.10.10.1:5432/mattermost?sslmode=disable&amp;connect_timeout=10&quot;</span></code></li>
</ul>
</div></blockquote>
<ul class="simple">
<li>If you are using MySQL:</li>
</ul>
<blockquote>
<div><ul class="simple">
<li>Set <code class="docutils literal"><span class="pre">DriverName&quot;:</span></code> to <code class="docutils literal"><span class="pre">&quot;mysql&quot;</span></code></li>
<li>Set <code class="docutils literal"><span class="pre">&quot;DataSource&quot;:</span></code> to the following value: <code class="docutils literal"><span class="pre">&quot;mmuser:mmuser_password&#64;tcp(10.10.10.1:3306)/mattermost?charset=utf8&quot;</span></code></li>
</ul>
</div></blockquote>
<ul class="simple">
<li>You can continue to edit configuration settings in
<code class="docutils literal"><span class="pre">config.json</span></code> or use the System Console described in a later
section to finish the configuration.</li>
</ul>
</li>
<li><p class="first">Test the Mattermost Server</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">cd</span> <span class="pre">~/mattermost/bin</span></code></li>
<li>Run the Mattermost Server by typing:</li>
<li><code class="docutils literal"><span class="pre">./platform</span></code></li>
<li>You should see a console log like <code class="docutils literal"><span class="pre">Server</span> <span class="pre">is</span> <span class="pre">listening</span> <span class="pre">on</span> <span class="pre">:8065</span></code>
letting you know the service is running.</li>
<li>Stop the server for now by typing <code class="docutils literal"><span class="pre">ctrl-c</span></code></li>
</ul>
</li>
<li><p class="first">Setup Mattermost to use the Upstart daemon which handles supervision
of the Mattermost process.</p>
<ul>
<li><p class="first"><code class="docutils literal"><span class="pre">sudo</span> <span class="pre">touch</span> <span class="pre">/etc/init/mattermost.conf</span></code></p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">sudo</span> <span class="pre">vi</span> <span class="pre">/etc/init/mattermost.conf</span></code></p>
</li>
<li><p class="first">Copy the following lines into <code class="docutils literal"><span class="pre">/etc/init/mattermost.conf</span></code></p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">start</span> <span class="n">on</span> <span class="n">runlevel</span> <span class="p">[</span><span class="mi">2345</span><span class="p">]</span>
<span class="n">stop</span> <span class="n">on</span> <span class="n">runlevel</span> <span class="p">[</span><span class="mi">016</span><span class="p">]</span>
<span class="n">respawn</span>
<span class="n">limit</span> <span class="n">nofile</span> <span class="mi">50000</span> <span class="mi">50000</span>
<span class="n">chdir</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">mattermost</span><span class="o">/</span><span class="n">mattermost</span>
<span class="n">setuid</span> <span class="n">mattermost</span>
<span class="n">exec</span> <span class="nb">bin</span><span class="o">/</span><span class="n">platform</span>
</pre></div>
</div>
</li>
<li><p class="first">You can manage the process by typing:</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">sudo</span> <span class="pre">start</span> <span class="pre">mattermost</span></code></p>
</li>
<li><p class="first">Verify the service is running by typing:</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">curl</span> <span class="pre">http://10.10.10.2:8065</span></code></p>
</li>
<li><p class="first">You should see a page titles <em>Mattermost - Signup</em></p>
</li>
<li><p class="first">You can also stop the process by running the command
<code class="docutils literal"><span class="pre">sudo</span> <span class="pre">stop</span> <span class="pre">mattermost</span></code>, but we will skip this step for now.</p>
</li>
</ul>
</li>
</ol>
</div>
<div class="section" id="set-up-nginx-server">
<h2>Set up NGINX Server<a class="headerlink" href="#set-up-nginx-server" title="Permalink to this headline">¶</a></h2>
<ol class="arabic">
<li><p class="first">For the purposes of this guide we will assume this server has an IP
address of <code class="docutils literal"><span class="pre">10.10.10.3</span></code></p>
</li>
<li><p class="first">We use NGINX for proxying request to the Mattermost Server. The main
benefits are:</p>
<ul class="simple">
<li>SSL termination</li>
<li>http to https redirect</li>
<li>Port mapping <code class="docutils literal"><span class="pre">:80</span></code> to <code class="docutils literal"><span class="pre">:8065</span></code></li>
<li>Standard request logs</li>
</ul>
</li>
<li><p class="first">Install NGINX on Ubuntu with</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">sudo</span> <span class="pre">apt-get</span> <span class="pre">install</span> <span class="pre">nginx</span></code></li>
</ul>
</li>
<li><p class="first">Verify NGINX is running</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">curl</span> <span class="pre">http://10.10.10.3</span></code></li>
<li>You should see a <em>Welcome to NGINX!</em> page</li>
</ul>
</li>
<li><p class="first">You can manage NGINX with the following commands</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">sudo</span> <span class="pre">service</span> <span class="pre">nginx</span> <span class="pre">stop</span></code></li>
<li><code class="docutils literal"><span class="pre">sudo</span> <span class="pre">service</span> <span class="pre">nginx</span> <span class="pre">start</span></code></li>
<li><code class="docutils literal"><span class="pre">sudo</span> <span class="pre">service</span> <span class="pre">nginx</span> <span class="pre">restart</span></code></li>
</ul>
</li>
<li><p class="first">Map a FQDN (fully qualified domain name) like
<code class="docutils literal"><span class="pre">mattermost.example.com</span></code> to point to the NGINX server.</p>
</li>
<li><p class="first">Configure NGINX to proxy connections from the internet to the
Mattermost Server</p>
<ul class="simple">
<li>Create a configuration for Mattermost</li>
<li><code class="docutils literal"><span class="pre">sudo</span> <span class="pre">touch</span> <span class="pre">/etc/nginx/sites-available/mattermost</span></code></li>
<li>Below is a sample nginx configuration optimized for performance:</li>
</ul>
<blockquote>
<div><div class="highlight-default"><div class="highlight"><pre><span></span>upstream backend {
    server 10.10.10.2:8065;
}

proxy_cache_path /var/cache/nginx levels=1:2 keys_zone=mattermost_cache:10m max_size=3g inactive=120m use_temp_path=off;

server {
    listen 80;
    server_name    mattermost.example.com;

    location /api/v3/users/websocket {
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection &quot;upgrade&quot;;
        client_max_body_size 50M;
        proxy_set_header Host $http_host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_set_header X-Frame-Options SAMEORIGIN;
        proxy_buffers 256 16k;
        proxy_buffer_size 16k;
        proxy_read_timeout 600s;
        proxy_pass http://backend;
    }

    location / {
        client_max_body_size 50M;
        proxy_set_header Connection &quot;&quot;;
        proxy_set_header Host $http_host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_set_header X-Frame-Options SAMEORIGIN;
        proxy_buffers 256 16k;
        proxy_buffer_size 16k;
        proxy_read_timeout 600s;
        proxy_cache mattermost_cache;
        proxy_cache_revalidate on;
        proxy_cache_min_uses 2;
        proxy_cache_use_stale timeout;
        proxy_cache_lock on;
        proxy_pass http://backend;
    }
}
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li>Remove the existing file with</li>
<li><code class="docutils literal"><span class="pre">`</span> <span class="pre">sudo</span> <span class="pre">rm</span> <span class="pre">/etc/nginx/sites-enabled/default`</span></code></li>
<li>Link the mattermost config by typing:</li>
<li><code class="docutils literal"><span class="pre">`sudo</span> <span class="pre">ln</span> <span class="pre">-s</span> <span class="pre">/etc/nginx/sites-available/mattermost</span> <span class="pre">/etc/nginx/sites-enabled/mattermost`</span></code></li>
<li>Restart NGINX by typing:</li>
<li><code class="docutils literal"><span class="pre">`</span> <span class="pre">sudo</span> <span class="pre">service</span> <span class="pre">nginx</span> <span class="pre">restart`</span></code></li>
<li>Verify you can see Mattermost thru the proxy by typing:</li>
<li><code class="docutils literal"><span class="pre">`</span> <span class="pre">curl</span> <span class="pre">http://localhost`</span></code></li>
<li>You should see a page titles <em>Mattermost - Signup</em></li>
</ul>
</li>
</ol>
</div>
<div class="section" id="set-up-nginx-with-ssl-recommended">
<h2>Set up NGINX with SSL (Recommended)<a class="headerlink" href="#set-up-nginx-with-ssl-recommended" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li>You can use a free and an open certificate security like let&#8217;s
encrypt, this is how to proceed</li>
</ol>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">sudo</span> <span class="pre">apt-get</span> <span class="pre">install</span> <span class="pre">git</span></code></li>
<li><code class="docutils literal"><span class="pre">git</span> <span class="pre">clone</span> <span class="pre">https://github.com/letsencrypt/letsencrypt</span></code></li>
<li><code class="docutils literal"><span class="pre">cd</span> <span class="pre">letsencrypt</span></code></li>
</ul>
<ol class="arabic simple" start="2">
<li>Be sure that the port 80 is not use by stopping NGINX</li>
</ol>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">sudo</span> <span class="pre">service</span> <span class="pre">nginx</span> <span class="pre">stop</span></code></li>
<li><code class="docutils literal"><span class="pre">netstat</span> <span class="pre">-na</span> <span class="pre">|</span> <span class="pre">grep</span> <span class="pre">':80.*LISTEN'</span></code></li>
<li><code class="docutils literal"><span class="pre">./letsencrypt-auto</span> <span class="pre">certonly</span> <span class="pre">--standalone</span></code></li>
</ul>
<ol class="arabic simple" start="3">
<li>This command will download packages and run the instance, after that
you will have to give your domain name</li>
<li>You can find your certificate in <code class="docutils literal"><span class="pre">/etc/letsencrypt/live</span></code></li>
<li>Modify the file at <code class="docutils literal"><span class="pre">/etc/nginx/sites-available/mattermost</span></code> and add
the following lines:</li>
</ol>
<blockquote>
<div><div class="highlight-default"><div class="highlight"><pre><span></span>upstream backend {
    server 10.10.10.2:8065;
}

server {
   listen         80;
   server_name    mattermost.example.com;
   return         301 https://$server_name$request_uri;
}

proxy_cache_path /var/cache/nginx levels=1:2 keys_zone=mattermost_cache:10m max_size=3g inactive=120m use_temp_path=off;

server {
   listen 443 ssl;
   server_name mattermost.example.com;

   ssl on;
   ssl_certificate /etc/letsencrypt/live/yourdomainname/fullchain.pem;
   ssl_certificate_key /etc/letsencrypt/live/yourdomainname/privkey.pem;
   ssl_session_timeout 5m;
   ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
   ssl_ciphers &#39;EECDH+AESGCM:EDH+AESGCM:AES256+EECDH:AES256+EDH&#39;;
   ssl_prefer_server_ciphers on;
   ssl_session_cache shared:SSL:10m;

   location /api/v3/users/websocket {
      proxy_set_header Upgrade $http_upgrade;
      proxy_set_header Connection &quot;upgrade&quot;;
      proxy_set_header X-Forwarded-Ssl on;
      client_max_body_size 50M;
      proxy_set_header Host $http_host;
      proxy_set_header X-Real-IP $remote_addr;
      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
      proxy_set_header X-Forwarded-Proto $scheme;
      proxy_set_header X-Frame-Options SAMEORIGIN;
      proxy_buffers 256 16k;
      proxy_buffer_size 16k;
      proxy_read_timeout 600s;
      proxy_pass http://backend;
   }

   location / {
      proxy_set_header X-Forwarded-Ssl on;
      client_max_body_size 50M;
      proxy_set_header Connection &quot;&quot;;
      proxy_set_header Host $http_host;
      proxy_set_header X-Real-IP $remote_addr;
      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
      proxy_set_header X-Forwarded-Proto $scheme;
      proxy_set_header X-Frame-Options SAMEORIGIN;
      proxy_buffers 256 16k;
      proxy_buffer_size 16k;
      proxy_read_timeout 600s;
      proxy_cache mattermost_cache;
      proxy_cache_revalidate on;
      proxy_cache_min_uses 2;
      proxy_cache_use_stale timeout;
      proxy_cache_lock on;
      proxy_pass http://backend;
    }
}
</pre></div>
</div>
</div></blockquote>
<ol class="arabic simple" start="6">
<li>Be sure to restart NGINX</li>
</ol>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal"><span class="pre">\</span> <span class="pre">sudo</span> <span class="pre">service</span> <span class="pre">nginx</span> <span class="pre">start</span></code></li>
</ul>
</div></blockquote>
<ol class="arabic simple" start="7">
<li>Add the following line to cron so the cert will renew every month</li>
</ol>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal"><span class="pre">crontab</span> <span class="pre">-e</span></code></li>
<li><code class="docutils literal"><span class="pre">&#64;monthly</span> <span class="pre">/home/ubuntu/letsencrypt/letsencrypt-auto</span> <span class="pre">certonly</span> <span class="pre">--reinstall</span> <span class="pre">--nginx</span> <span class="pre">-d</span> <span class="pre">yourdomainname</span> <span class="pre">&amp;&amp;</span> <span class="pre">sudo</span> <span class="pre">service</span> <span class="pre">nginx</span> <span class="pre">reload</span></code></li>
</ul>
</div></blockquote>
<ol class="arabic simple" start="8">
<li>Check that your SSL certificate is set up correctly</li>
</ol>
<blockquote>
<div><ul class="simple">
<li>Test the SSL certificate by visiting a site such as <a class="reference external" href="https://www.ssllabs.com/ssltest/index.html">https://www.ssllabs.com/ssltest/index.html</a></li>
<li>If there’s an error about the missing chain or certificate path, there is likely an intermediate certificate missing that needs to be included</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="setup-http2">
<h2>Setup HTTP2<a class="headerlink" href="#setup-http2" title="Permalink to this headline">¶</a></h2>
<p>It is recommended to enable HTTP2 for enhanced performance.</p>
<ol class="arabic simple">
<li>Modify your NGINX configuration as above. Then,</li>
</ol>
<blockquote>
<div><ul class="simple">
<li>Change the line <code class="docutils literal"><span class="pre">listen</span> <span class="pre">443</span> <span class="pre">ssl;</span></code> to <code class="docutils literal"><span class="pre">listen</span> <span class="pre">443</span> <span class="pre">ssl</span> <span class="pre">http2;</span></code></li>
<li>Change the line <code class="docutils literal"><span class="pre">proxy_pass</span> <span class="pre">http://10.10.10.2:8065;</span></code> to <code class="docutils literal"><span class="pre">proxy_pass</span> <span class="pre">https://10.10.10.2:8065;</span></code></li>
</ul>
</div></blockquote>
<ol class="arabic simple" start="2">
<li>Restart NGINX</li>
<li>Setup TLS on the Mattermost server by following <a class="reference external" href="https://docs.mattermost.com/install/setup-tls.html">these instrucions.</a></li>
</ol>
</div>
<div class="section" id="test-setup-and-configure-mattermost-server">
<h2>Test setup and configure Mattermost Server<a class="headerlink" href="#test-setup-and-configure-mattermost-server" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li>Navigate to <code class="docutils literal"><span class="pre">https://mattermost.example.com</span></code> and create a team and
user.</li>
<li>The first user in the system is automatically granted the
<code class="docutils literal"><span class="pre">system_admin</span></code> role, which gives you access to the System Console.</li>
<li>From the <code class="docutils literal"><span class="pre">town-square</span></code> channel click the dropdown and choose the
<code class="docutils literal"><span class="pre">System</span> <span class="pre">Console</span></code> option</li>
<li>Update <strong>Notification</strong> &gt; <strong>Email</strong> settings to setup an SMTP email service. The example below assumes AmazonSES.</li>
</ol>
<blockquote>
<div><ul class="simple">
<li>Set <em>Send Email Notifications</em> to <code class="docutils literal"><span class="pre">true</span></code></li>
<li>Set <em>Require Email Verification</em> to <code class="docutils literal"><span class="pre">true</span></code></li>
<li>Set <em>Feedback Name</em> to <code class="docutils literal"><span class="pre">No-Reply</span></code></li>
<li>Set <em>Feedback Email</em> to <code class="docutils literal"><span class="pre">mattermost&#64;example.com</span></code></li>
<li>Set <em>SMTP Username</em> to <code class="docutils literal"><span class="pre">[YOUR_SMTP_USERNAME]</span></code></li>
<li>Set <em>SMTP Password</em> to <code class="docutils literal"><span class="pre">[YOUR_SMTP_PASSWORD]</span></code></li>
<li>Set <em>SMTP Server</em> to <code class="docutils literal"><span class="pre">email-smtp.us-east-1.amazonaws.com</span></code></li>
<li>Set <em>SMTP Port</em> to <code class="docutils literal"><span class="pre">465</span></code></li>
<li>Set <em>Connection Security</em> to <code class="docutils literal"><span class="pre">TLS</span></code></li>
<li>Save the Settings</li>
</ul>
</div></blockquote>
<ol class="arabic simple" start="5">
<li>Update <strong>File</strong> &gt; <strong>Storage</strong> settings:<ul>
<li>Change <em>Local Directory Location</em> from <code class="docutils literal"><span class="pre">./data/</span></code> to
<code class="docutils literal"><span class="pre">/mattermost/data</span></code></li>
</ul>
</li>
<li>Update <strong>General</strong> &gt; <strong>Logging</strong> settings:<ul>
<li>Set <em>Log to The Console</em> to <code class="docutils literal"><span class="pre">false</span></code></li>
</ul>
</li>
<li>Feel free to modify other settings.</li>
<li>Restart the Mattermost Service by typing:<ul>
<li><code class="docutils literal"><span class="pre">sudo</span> <span class="pre">restart</span> <span class="pre">mattermost</span></code></li>
</ul>
</li>
</ol>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="prod-ubuntu-16.04.html" class="btn btn-neutral float-right" title="Production Install on Ubuntu 16.04 LTS" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="prod-docker.html" class="btn btn-neutral" title="Production Docker Deployment" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, 2016 Mattermost.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  
 




<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
        <span class="fa fa-cog">&nbsp;&nbsp;Options</span>&nbsp;
        <span class="fa fa-angle-up"></span>
    </span>
    <div class="rst-other-versions">
        <dl>
            <dt>Contribute</dt>
            <dd>
                <a href="https://github.com/mattermost/docs/issues">Report a Problem</a>
            </dd>
            
            <dd>
                <a href="https://github.com/mattermost/docs/blob/master/source/install/prod-ubuntu-1404.rst"> Edit on GitHub</a>
            </dd>
            
        </dl>
    </div>
</div>


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'3.5',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="../_static/myscript.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
  
	<header>
	<div class="header__container">
		<a href="http://docs.mattermost.com/" class="header__logo">
			<img width="176" src="https://about.mattermost.com/wp-content/uploads/2016/01/logo.png">
		</a>
		<div class="links__icon">
			<i class="fa fa-bars"></i>
		</div>
		<ul class="header__links">
			<li><a href="https://about.mattermost.com/solutions/">Solutions</a></li>
			<li><a href="https://about.mattermost.com/features/">Features</a></li>
			<li><a class="active" href="http://docs.mattermost.com/">Documentation</a></li>
			<li><a href="https://about.mattermost.com/pricing/">Pricing</a></li>
			<li><a href="https://about.mattermost.com/contact/">Contact</a></li>
			<li><a href="https://www.mattermost.org/download/">Download</a></li>
		</ul>
	</div>
</header>


</body>
</html>