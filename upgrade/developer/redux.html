


<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Working with Redux &mdash; Mattermost 3.10 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../_static/theme.css" type="text/css" />
  

  
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="Mattermost 3.10 documentation" href="../index.html"/>
        <link rel="up" title="Mattermost Developer’s Guide" href="../guides/developer.html"/>
        <link rel="next" title="Running Mattermost" href="running-mattermost.html"/>
        <link rel="prev" title="Building a Webapp React Component" href="webapp-component.html"/>
	
		<!-- Google Analytics -->
		<script>
			(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
			(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
			m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
			})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

			ga('create', 'UA-67846571-2', 'auto');
			ga('send', 'pageview');
		</script>
		<!-- End Google Analytics -->
	


  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> Mattermost
          

          
          </a>

          
            
            
              <div class="version">
                3.10
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../overview/index.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../guides/user.html">User&#8217;s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../guides/administrator.html">Administrator&#8217;s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../guides/administrator.html#changelog">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../guides/integration.html">Integration Guide</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../guides/developer.html">Developer&#8217;s Guide</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../guides/developer.html#development-process">Development Process</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="contribution-guide.html">Code Contribution Guidelines</a></li>
<li class="toctree-l3"><a class="reference internal" href="dev-setup.html">Developer Machine Setup</a></li>
<li class="toctree-l3"><a class="reference internal" href="mobile-developer-setup.html">Mobile Developer Machine Setup</a></li>
<li class="toctree-l3"><a class="reference internal" href="api.html">Mattermost APIs</a></li>
<li class="toctree-l3"><a class="reference internal" href="api4.html">APIv4 Contribution Process</a></li>
<li class="toctree-l3"><a class="reference internal" href="developer-flow.html">Developer Flow</a></li>
<li class="toctree-l3"><a class="reference internal" href="webapp-to-redux.html">Migrating the Webapp to Redux</a></li>
<li class="toctree-l3"><a class="reference internal" href="webapp-component.html">Building a Webapp React Component</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Working with Redux</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#adding-an-action">Adding an Action</a></li>
<li class="toctree-l4"><a class="reference internal" href="#adding-a-selector">Adding a Selector</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="running-mattermost.html">Running Mattermost</a></li>
<li class="toctree-l3"><a class="reference internal" href="style-guide.html">Mattermost Style Guide</a></li>
<li class="toctree-l3"><a class="reference internal" href="fx-guidelines.html">User Experience Guidelines</a></li>
<li class="toctree-l3"><a class="reference internal" href="localization.html">Localization</a></li>
<li class="toctree-l3"><a class="reference internal" href="core-developer-handbook.html">Core Developer Handbook</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../guides/developer.html#definitions">Definitions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guides/developer.html#unofficial-enhancements">Unofficial Enhancements</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../guides/core.html">Core Team Handbook</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">Mattermost</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          


  


<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
    
      <li><a href="../guides/developer.html">Mattermost Developer&#8217;s Guide</a> &raquo;</li>
    
    <li>Working with Redux</li>
    <li class="wy-breadcrumbs-aside">
      
        
          <a href="https://github.com/mattermost/docs/blob/master/source/developer/redux.rst" class="fa fa-github"> Edit</a>
        
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="working-with-redux">
<h1>Working with Redux<a class="headerlink" href="#working-with-redux" title="Permalink to this headline">¶</a></h1>
<p>This page describes how to add actions and selectors to the client service and storage layer built on Redux. This Redux service layer is what drives the majority of actions, storage and server interaction for both the Mattermost webapp and the React Native mobile apps.</p>
<p>As of Mattermost version 3.9, the webapp has begun moving to replace Flux with Redux. If you&#8217;re interested in contributing to this campaign, please see <a class="reference external" href="./webapp-to-redux.html">migrating webapp components to Redux</a> and join the <a class="reference external" href="https://pre-release.mattermost.com/core/channels/redux">Redux channel on pre-release.mattermost.com</a>.</p>
<p>The respository for the Redux service layer is here: <a class="reference external" href="https://github.com/mattermost/mattermost-redux">https://github.com/mattermost/mattermost-redux</a></p>
<p>New to Redux? Then check out these links:</p>
<ul class="simple">
<li><a class="reference external" href="http://redux.js.org/">http://redux.js.org/</a></li>
<li><a class="reference external" href="https://www.youtube.com/playlist?list=PLoYCgNOIyGADILc3iUJzygCqC8Tt3bRXt">https://www.youtube.com/playlist?list=PLoYCgNOIyGADILc3iUJzygCqC8Tt3bRXt</a></li>
<li><a class="reference external" href="https://github.com/gaearon/redux-thunk">https://github.com/gaearon/redux-thunk</a></li>
</ul>
<div class="section" id="adding-an-action">
<h2>Adding an Action<a class="headerlink" href="#adding-an-action" title="Permalink to this headline">¶</a></h2>
<p>Actions are any sort of logic that will result in the manipulation of store state. The means by which actions manipulate the store is through dispatches. Dispatches will take an object with an action type and some data, and pass it along to the reducers to be transformed into the correct format and placed in the state of the store. An example action might be getting a user, which would use the web client utility to fetch the user and then dispatch that user to the store.</p>
<p>Actions must:
- Return <a class="reference external" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/async_function">async functions</a> so the caller can <a class="reference external" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/await">await</a> on them
- The async function must return <code class="docutils literal"><span class="pre">null</span></code> on error, while dispatching an error to store state
- The async function must return the data result or return <code class="docutils literal"><span class="pre">true</span></code> if there is no data to return, while dispatching the data
- May be chained to return the results of other actions
- Be unit tested</p>
<p>Actions live in the <code class="docutils literal"><span class="pre">src/actions/</span></code> directory.</p>
<div class="section" id="add-action-types">
<h3>Add Action Types<a class="headerlink" href="#add-action-types" title="Permalink to this headline">¶</a></h3>
<p>Action types are the constants the reducers use to know what type of data they are receiving and what to do with it. Generally, there are two kinds of action types you&#8217;ll need to worry about: data and requests.</p>
<p>Data action types are what you&#8217;ll use to dispatch the result of your action to the reducers. If your action is manipulating or fetching data in a format already handled by the store, then there might be no need to add a new action type. An example data action type is <code class="docutils literal"><span class="pre">RECEIVED_USER</span></code>.</p>
<p>Request action types are used to track the state of server requests. Non-optimisitic actions that use the web client utility to interact with the server need three request action types, one for the start of the request, one for success and one for failure. If the request you&#8217;re using already has action types, then no need to add any. Examples of request action types are <code class="docutils literal"><span class="pre">USER_REQUEST</span></code>, <code class="docutils literal"><span class="pre">USER_SUCCESS</span></code> and <code class="docutils literal"><span class="pre">USER_FAILURE</span></code>.</p>
<p>Note that if you&#8217;re planning on writing an optimistic action, you do not need to specify request action types.</p>
<p>Add your action types to the appropriate file in <code class="docutils literal"><span class="pre">src/action_types/</span></code>. When adding request action types you&#8217;ll also need to add the reducer in <code class="docutils literal"><span class="pre">src/reducers/requests/</span></code>. Just follow the examples in those files, it&#8217;s fairly straight forward.</p>
</div>
<div class="section" id="add-a-web-service-function">
<h3>Add a Web Service Function<a class="headerlink" href="#add-a-web-service-function" title="Permalink to this headline">¶</a></h3>
<p>If your action is going to use a new REST API endpoint on the server, you&#8217;ll need to add a function to the web client utility.</p>
<p>The web client lives at <code class="docutils literal"><span class="pre">src/client/client4.js</span></code>. <a class="reference external" href="https://developer.mozilla.org/en/docs/Web/API/Fetch_API">Fetch</a> is the library used to interact with the Mattermost REST API.</p>
<p>Adding a function should also be fairly straight-forward, just use the existing functions as an example.</p>
</div>
<div class="section" id="implementing-the-action">
<h3>Implementing the Action<a class="headerlink" href="#implementing-the-action" title="Permalink to this headline">¶</a></h3>
<p>The actual implementation of the action will vary depending on what you&#8217;re trying to accomplish. Actions live in the <code class="docutils literal"><span class="pre">src/actions/</span></code> directory. Make sure to add your action to the appropriate file.</p>
<p>If your action is a one-to-one mapping of a web client function, all you need to do is use the <code class="docutils literal"><span class="pre">bindClientFunc</span></code> function to do the mapping.</p>
<div class="highlight-javascript"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kr">export</span> <span class="kd">function</span> <span class="nx">getUser</span><span class="p">(</span><span class="nx">userId</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">bindClientFunc</span><span class="p">(</span>
        <span class="nx">Client4</span><span class="p">.</span><span class="nx">getUser</span><span class="p">,</span> <span class="c1">// The client method</span>
        <span class="nx">UserTypes</span><span class="p">.</span><span class="nx">USER_REQUEST</span><span class="p">,</span> <span class="c1">// The type of action dispatched when the request is started</span>
        <span class="p">[</span><span class="nx">UserTypes</span><span class="p">.</span><span class="nx">RECEIVED_USER</span><span class="p">,</span> <span class="nx">UserTypes</span><span class="p">.</span><span class="nx">USER_SUCCESS</span><span class="p">],</span> <span class="c1">// One or more types of actions dispatched when the request is completed</span>
        <span class="nx">UserTypes</span><span class="p">.</span><span class="nx">USER_FAILURE</span><span class="p">,</span> <span class="c1">// The type of action dispatched when the request fails</span>
        <span class="nx">userId</span> <span class="c1">// Any other arguments to the action that will be passed to the client call</span>
    <span class="p">);</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>The above action just gets a user and is a one-to-one mapping to the <code class="docutils literal"><span class="pre">getUser</span></code> web client function.</p>
<p>If it&#8217;s not a one-to-one mapping and you need to manipulate the data you get back from the web client, then you&#8217;ll need to do a bit more manual work.</p>
<div class="highlight-javascript"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kr">export</span> <span class="kd">function</span> <span class="nx">getProfiles</span><span class="p">(</span><span class="nx">page</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">perPage</span> <span class="o">=</span> <span class="nx">General</span><span class="p">.</span><span class="nx">PROFILE_CHUNK_SIZE</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">async</span> <span class="p">(</span><span class="nx">dispatch</span><span class="p">,</span> <span class="nx">getState</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
        <span class="nx">dispatch</span><span class="p">({</span><span class="nx">type</span><span class="o">:</span> <span class="nx">UserTypes</span><span class="p">.</span><span class="nx">PROFILES_REQUEST</span><span class="p">},</span> <span class="nx">getState</span><span class="p">);</span>

        <span class="kr">const</span> <span class="p">{</span><span class="nx">currentUserId</span><span class="p">}</span> <span class="o">=</span> <span class="nx">getState</span><span class="p">().</span><span class="nx">entities</span><span class="p">.</span><span class="nx">users</span><span class="p">;</span>

        <span class="kd">let</span> <span class="nx">profiles</span><span class="p">;</span>
        <span class="k">try</span> <span class="p">{</span>
            <span class="nx">profiles</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">Client4</span><span class="p">.</span><span class="nx">getProfiles</span><span class="p">(</span><span class="nx">page</span><span class="p">,</span> <span class="nx">perPage</span><span class="p">);</span>
            <span class="nx">removeUserFromList</span><span class="p">(</span><span class="nx">currentUserId</span><span class="p">,</span> <span class="nx">profiles</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">forceLogoutIfNecessary</span><span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">dispatch</span><span class="p">);</span>
            <span class="nx">dispatch</span><span class="p">(</span><span class="nx">batchActions</span><span class="p">([</span>
                <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nx">UserTypes</span><span class="p">.</span><span class="nx">PROFILES_FAILURE</span><span class="p">,</span> <span class="nx">error</span><span class="p">},</span>
                <span class="nx">getLogErrorAction</span><span class="p">(</span><span class="nx">error</span><span class="p">)</span>
            <span class="p">]),</span> <span class="nx">getState</span><span class="p">);</span>
            <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="nx">dispatch</span><span class="p">(</span><span class="nx">batchActions</span><span class="p">([</span>
            <span class="p">{</span>
                <span class="nx">type</span><span class="o">:</span> <span class="nx">UserTypes</span><span class="p">.</span><span class="nx">RECEIVED_PROFILES_LIST</span><span class="p">,</span>
                <span class="nx">data</span><span class="o">:</span> <span class="nx">profiles</span>
            <span class="p">},</span>
            <span class="p">{</span>
                <span class="nx">type</span><span class="o">:</span> <span class="nx">UserTypes</span><span class="p">.</span><span class="nx">PROFILES_SUCCESS</span>
            <span class="p">}</span>
        <span class="p">]));</span>

        <span class="k">return</span> <span class="nx">profiles</span><span class="p">;</span>
    <span class="p">};</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>In the above action, we need to remove the current user from profile list so that we don&#8217;t overwrite it in the state. Because of the need to do that, we could not use <code class="docutils literal"><span class="pre">bindClientFunc</span></code>.</p>
<p>It is also possible to write optimistic actions that dispatch data to the store immediately before waiting for a response from the server. These are a little more advanced and should only be used in situations that warrant them. The framework that drives this is <a class="reference external" href="https://github.com/jevakallio/redux-offline">redux-offline</a>.</p>
<div class="highlight-javascript"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kr">export</span> <span class="kd">function</span> <span class="nx">deletePost</span><span class="p">(</span><span class="nx">post</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">async</span> <span class="p">(</span><span class="nx">dispatch</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
        <span class="kr">const</span> <span class="nx">delPost</span> <span class="o">=</span> <span class="p">{...</span><span class="nx">post</span><span class="p">};</span>

        <span class="nx">dispatch</span><span class="p">({</span>
            <span class="nx">type</span><span class="o">:</span> <span class="nx">PostTypes</span><span class="p">.</span><span class="nx">POST_DELETED</span><span class="p">,</span>
            <span class="nx">data</span><span class="o">:</span> <span class="nx">delPost</span><span class="p">,</span>
            <span class="nx">meta</span><span class="o">:</span> <span class="p">{</span>
                <span class="nx">offline</span><span class="o">:</span> <span class="p">{</span>
                    <span class="nx">effect</span><span class="o">:</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="nx">Client4</span><span class="p">.</span><span class="nx">deletePost</span><span class="p">(</span><span class="nx">post</span><span class="p">.</span><span class="nx">id</span><span class="p">),</span>
                    <span class="nx">commit</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nx">PostTypes</span><span class="p">.</span><span class="nx">POST_DELETED</span><span class="p">},</span>
                    <span class="nx">rollback</span><span class="o">:</span> <span class="p">{</span>
                        <span class="nx">type</span><span class="o">:</span> <span class="nx">PostTypes</span><span class="p">.</span><span class="nx">RECEIVED_POST</span><span class="p">,</span>
                        <span class="nx">data</span><span class="o">:</span> <span class="nx">delPost</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">});</span>
    <span class="p">};</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>There can also be actions that just wrap one or more existing actions.</p>
<div class="highlight-javascript"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kr">export</span> <span class="kd">function</span> <span class="nx">flagPost</span><span class="p">(</span><span class="nx">postId</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">async</span> <span class="p">(</span><span class="nx">dispatch</span><span class="p">,</span> <span class="nx">getState</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
        <span class="kr">const</span> <span class="p">{</span><span class="nx">currentUserId</span><span class="p">}</span> <span class="o">=</span> <span class="nx">getState</span><span class="p">().</span><span class="nx">entities</span><span class="p">.</span><span class="nx">users</span><span class="p">;</span>
        <span class="kr">const</span> <span class="nx">preference</span> <span class="o">=</span> <span class="p">{</span>
            <span class="nx">user_id</span><span class="o">:</span> <span class="nx">currentUserId</span><span class="p">,</span>
            <span class="nx">category</span><span class="o">:</span> <span class="nx">Preferences</span><span class="p">.</span><span class="nx">CATEGORY_FLAGGED_POST</span><span class="p">,</span>
            <span class="nx">name</span><span class="o">:</span> <span class="nx">postId</span><span class="p">,</span>
            <span class="nx">value</span><span class="o">:</span> <span class="s1">&#39;true&#39;</span>
        <span class="p">};</span>

        <span class="nx">savePreferences</span><span class="p">(</span><span class="nx">currentUserId</span><span class="p">,</span> <span class="p">[</span><span class="nx">preference</span><span class="p">])(</span><span class="nx">dispatch</span><span class="p">,</span> <span class="nx">getState</span><span class="p">);</span>
    <span class="p">};</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>Make sure to also add your function to the default export at the bottom of the file.</p>
</div>
<div class="section" id="testing-the-action">
<h3>Testing the Action<a class="headerlink" href="#testing-the-action" title="Permalink to this headline">¶</a></h3>
<p>The final piece is testing your action. We use the <a class="reference external" href="https://mochajs.org/">mochajs framework</a> for testing, along with the <a class="reference external" href="https://github.com/node-nock/nock">nock server mocking framework</a> to mock the server where needed.</p>
<p>The tests for actions live in <code class="docutils literal"><span class="pre">test/actions/</span></code>. Add your test to the appropriate file following one of the many examples for the other actions.</p>
<p>Make sure to read the <a class="reference external" href="https://github.com/mattermost/mattermost-redux/blob/master/README.md">README</a> for information on running the tests.</p>
</div>
</div>
<div class="section" id="adding-a-selector">
<h2>Adding a Selector<a class="headerlink" href="#adding-a-selector" title="Permalink to this headline">¶</a></h2>
<p>Selectors are the method used to retrieve data from the state of the store. We use <a class="reference external" href="https://github.com/reactjs/reselect">reselect</a>. If you&#8217;d like to know more about reselect and how we use it at Mattermost, <a class="reference external" href="https://www.youtube.com/watch?v=6N2X7gEwmaQ">check out this developer talk given by core developer Harrison Healey</a>.</p>
<p>Selectors must:
- Receive <code class="docutils literal"><span class="pre">state</span></code> as the first argument and return data based solely on what&#8217;s in the state
- Be created with <code class="docutils literal"><span class="pre">createSelector</span></code> whenever the data is manipulated or formatted before return
- Be unit tested</p>
<p>Selectors live in the <code class="docutils literal"><span class="pre">src/selectors/</span></code> directory.</p>
<div class="section" id="implementing-the-selector">
<h3>Implementing the Selector<a class="headerlink" href="#implementing-the-selector" title="Permalink to this headline">¶</a></h3>
<p>If your selector is just pulling data directly from the state without any manipulation, simply return the data you need.</p>
<div class="highlight-javascript"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kr">export</span> <span class="kd">function</span> <span class="nx">getUser</span><span class="p">(</span><span class="nx">state</span><span class="p">,</span> <span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">state</span><span class="p">.</span><span class="nx">entities</span><span class="p">.</span><span class="nx">users</span><span class="p">.</span><span class="nx">profiles</span><span class="p">[</span><span class="nx">id</span><span class="p">];</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>The above example is just simply pulling a user out of the profiles entity and requires no computation or formatting.</p>
<p>If your selector needs to select based on some more advanced requirements or needs the result in a specific format then you&#8217;ll need to make use of the <code class="docutils literal"><span class="pre">createSelector</span></code> function from <a class="reference external" href="https://github.com/reactjs/reselect">reselect &lt;reselect</a>. If you&#8217;re not sure what this is good for, <a class="reference external" href="https://www.youtube.com/watch?v=6N2X7gEwmaQ">check out the previously mentioned developer talk</a>. The short form reason is using reselect allows for memoization and only runs the computation of selectors when the state affecting that selector has actually changed.</p>
<p>The basic usage for <code class="docutils literal"><span class="pre">createSelector</span></code> is to pass it all the selector functions needed as inputs to your computation. The last argument should then be a function that takes in the results of each previous selector, performs some computations, and then returns the result.</p>
<div class="highlight-javascript"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kr">export</span> <span class="kr">const</span> <span class="nx">getUsersByUsername</span> <span class="o">=</span> <span class="nx">createSelector</span><span class="p">(</span>
    <span class="nx">getUsers</span><span class="p">,</span>
    <span class="p">(</span><span class="nx">users</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
        <span class="kr">const</span> <span class="nx">usersByUsername</span> <span class="o">=</span> <span class="p">{};</span>

        <span class="k">for</span> <span class="p">(</span><span class="kr">const</span> <span class="nx">id</span> <span class="k">in</span> <span class="nx">users</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">users</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">id</span><span class="p">))</span> <span class="p">{</span>
                <span class="kr">const</span> <span class="nx">user</span> <span class="o">=</span> <span class="nx">users</span><span class="p">[</span><span class="nx">id</span><span class="p">];</span>
                <span class="nx">usersByUsername</span><span class="p">[</span><span class="nx">user</span><span class="p">.</span><span class="nx">username</span><span class="p">]</span> <span class="o">=</span> <span class="nx">user</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nx">usersByUsername</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">);</span>
</pre></div>
</td></tr></table></div>
<p>Here we&#8217;re using the <code class="docutils literal"><span class="pre">getUsers</span></code> selector to feed users into our function that builds a map of users with username as the key.</p>
<p>So far that&#8217;s pretty straightforward, but what if you want to select some data based on an argument? That is a little more tricky if you haven&#8217;t wrapped your head around the purpose of reselect and how createSelector works, so if you haven&#8217;t watched the developer talk linked above, I would strongly suggest it.</p>
<p>To accomplish this we need to create factory function that will create the selector, instead of just creating the selector directly.</p>
<div class="highlight-javascript"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">getAllFiles</span><span class="p">(</span><span class="nx">state</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">state</span><span class="p">.</span><span class="nx">entities</span><span class="p">.</span><span class="nx">files</span><span class="p">.</span><span class="nx">files</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">getFilesIdsByPosts</span><span class="p">(</span><span class="nx">state</span><span class="p">,</span> <span class="nx">post</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">state</span><span class="p">.</span><span class="nx">entities</span><span class="p">.</span><span class="nx">files</span><span class="p">.</span><span class="nx">fileIdsByPostId</span><span class="p">;</span>
<span class="p">}</span>

<span class="kr">export</span> <span class="kd">function</span> <span class="nx">makeGetFilesForPost</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">createSelector</span><span class="p">(</span>
        <span class="nx">getAllFiles</span><span class="p">,</span>
        <span class="nx">getFilesIdsForPost</span><span class="p">,</span>
        <span class="p">(</span><span class="nx">state</span><span class="p">,</span> <span class="nx">postId</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="nx">postId</span><span class="p">,</span>
        <span class="p">(</span><span class="nx">allFiles</span><span class="p">,</span> <span class="nx">fileIdsForPost</span><span class="p">,</span> <span class="nx">postId</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">fileIdsForPost</span><span class="p">.</span><span class="nx">map</span><span class="p">((</span><span class="nx">id</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="nx">allFiles</span><span class="p">[</span><span class="nx">id</span><span class="p">]);</span>
        <span class="p">}</span>
    <span class="p">);</span>
<span class="p">}</span>

<span class="c1">// Usage by a third party application</span>
<span class="kr">const</span> <span class="nx">getFilesForPost</span> <span class="o">=</span> <span class="nx">makeGetFilesForPost</span><span class="p">();</span>
<span class="kr">const</span> <span class="nx">files</span> <span class="o">=</span> <span class="nx">getFilesForPost</span><span class="p">(</span><span class="nx">state</span><span class="p">,</span> <span class="s1">&#39;somepostid&#39;</span><span class="p">);</span>
</pre></div>
</td></tr></table></div>
<p>This can look a bit confusing, but there is little happening here we haven&#8217;t seen before. All that we&#8217;re doing is using three selectors with <code class="docutils literal"><span class="pre">createSelector</span></code>, the third selector just happens to be returning its second argument so that our final function has access to it. Remember that every selector always takes state in as the first argument.</p>
<p>If you&#8217;re thinking, &#8220;I don&#8217;t get it. Why can&#8217;t we just create the selector normally?&#8221; then think about how selectors work and remember that if the state changes then the computation happens again. When the postId changes, that counts as a state change, so every time we provide a different <code class="docutils literal"><span class="pre">postId</span></code> to our selector we lose all the benefits of memoization, which is the whole reason for using reselect. Instead, we create copies of our selector everywhere we know the post id shouldn&#8217;t change frequently. That may seem a little crazy at first, but if you think about how componentized React is, it&#8217;s not that bad. All you really need to do is use the factory function to create an instance of your selector for each component and use it solely for that component.</p>
</div>
<div class="section" id="testing-the-selector">
<h3>Testing the Selector<a class="headerlink" href="#testing-the-selector" title="Permalink to this headline">¶</a></h3>
<p>To test your selector you&#8217;ll want to add a test to the appropriate file in the <code class="docutils literal"><span class="pre">tests/selectos</span></code> directory.</p>
<p>Testing selectors invovles building some test state and confirming that the data returned from your selector matches what you would expect it to return. Use other tests as examples and make sure to read the <a class="reference external" href="https://github.com/mattermost/mattermost-redux/blob/master/README.md">README</a> for information on running the tests.</p>
</div>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="running-mattermost.html" class="btn btn-neutral float-right" title="Running Mattermost" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="webapp-component.html" class="btn btn-neutral" title="Building a Webapp React Component" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, 2016, 2017 Mattermost.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  
 




<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
        <span class="fa fa-cog">&nbsp;&nbsp;Options</span>&nbsp;
        <span class="fa fa-angle-up"></span>
    </span>
    <div class="rst-other-versions">
        <dl>
            <dt>Contribute</dt>
            <dd>
                <a href="https://github.com/mattermost/docs/issues">Report a Problem</a>
            </dd>
            
            <dd>
                <a href="https://github.com/mattermost/docs/blob/master/source/developer/redux.rst"> Edit on GitHub</a>
            </dd>
            
        </dl>
    </div>
</div>


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'3.10',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="../_static/myscript.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
  
	<header>
	<div class="header__container">
		<div class="search__icon">
			<i class="fa fa-search"></i>
		</div>
		<a href="http://docs.mattermost.com/" class="header__logo">
			<img width="176" src="https://about.mattermost.com/wp-content/uploads/2017/03/headerlogo.svg">
		</a>
		<div class="links__icon">
			<i class="fa fa-bars"></i>
		</div>
		<ul class="header__links">
			<li><a href="https://about.mattermost.com/solutions/">Solutions</a></li>
			<li><a href="https://about.mattermost.com/features/">Features</a></li>
			<li><a class="active" href="http://docs.mattermost.com/">Documentation</a></li>
			<li><a href="https://about.mattermost.com/pricing/">Pricing</a></li>
			<li><a href="https://about.mattermost.com/contact/">Contact</a></li>
			<li><a href="https://www.mattermost.org/download/">Download</a></li>
		</ul>
		<div class="header__searchbar">
			<form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
                <input type="text" name="q" placeholder="Search by keyword" autofocus />
                <input type="hidden" name="check_keywords" value="yes" />
                <input type="hidden" name="area" value="default" />
            </form>
		</div>
	</div>
</header>
	<script type="text/javascript">
		/* Temporary fix for the search capability. Fix has been committed to the theme's master;
		   however, waiting a new release to the theme.  This fix should remain in place until that
		   time.  sphinx_rtd_theme is current v0.1.10a0. Commit for the fix in the 
		   theme can be found at: https://github.com/snide/sphinx_rtd_theme/commit/a5e0e304
		 */
        if(DOCUMENTATION_OPTIONS) {
			DOCUMENTATION_OPTIONS.SOURCELINK_SUFFIX = '.txt' 
        }
    </script>


</body>
</html>